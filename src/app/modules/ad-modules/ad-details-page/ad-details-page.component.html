<div class="container">
  @if ((loading$ | async)?.['detail']) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è...</p>
    </div>
  }

  @if (!(element$ | async) && !(loading$ | async)?.['detail']) {
    <div class="not-found-state">
      –û–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ! ID: {{ route.snapshot.paramMap.get('id') }}
    </div>
  }

  @if (hasData$ | async) {
    @if (element$ | async; as advertisement) {
      <div class="card-container">

        @if (isOwner) {
          <div class="card-actions">
            <button class="btn-edit" (click)="onEdit()" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ">
              –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
            </button>
          </div>
        }

        <div class="card-header">
          <h1 class="card-title">{{ advertisement.name }}</h1>
          <p class="card-price">{{ advertisement.cost | number }} ‚ÇΩ</p>
        </div>

        <div class="card-content">
          <div class="card-image-section">
            <div class="card-image">
              @if (hasAdvertisementImage && currentImageUrl) {
                <div>
                  <img [src]="currentImageUrl"
                       [alt]="advertisement.name"
                       (error)="onImageError($event)"
                       class="card-image__img">

                  @if (hasMultipleImages()) {
                    <div class="image-navigation">
                      <button class="nav-btn prev-btn" (click)="prevImage()">‚Äπ</button>
                      <span class="image-counter">{{ currentImageIndex + 1 }} / {{ allImageUrls.length }}</span>
                      <button class="nav-btn next-btn" (click)="nextImage()">‚Ä∫</button>
                    </div>
                  }
                </div>
              } @else {
                <div class="no-image-placeholder">
                  <div class="placeholder-content">
                    <span class="placeholder-icon">üì∑</span>
                    <span class="placeholder-text">–ù–µ—Ç —Ñ–æ—Ç–æ</span>
                  </div>
                </div>
              }
            </div>
          </div>

          <div class="ad-info-section">
            <div class="ad-details">
              <div class="ad-contact-section">
                <button class="phone-toggle" (click)="togglePhone()">
                  {{ showPhone ? getPhoneNumber(advertisement) : '–ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä' }}
                </button>

                <div class="address-section">
                  <h3 class="section-title">–ê–¥—Ä–µ—Å</h3>
                  <p class="address-text">{{ advertisement.location }}</p>
                  <a href="#" class="map-link">–æ—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</a>
                </div>

                @if (advertisement.user) {
                  <div class="user-section">
                    <h3 class="section-title">–ü—Ä–æ–¥–∞–≤–µ—Ü</h3>
                    <div class="user-info">
                      <p><strong>–ò–º—è:</strong> {{ advertisement.user.name }}</p>
                      <p><strong>–õ–æ–≥–∏–Ω:</strong> {{ advertisement.user.login }}</p>
                    </div>
                  </div>
                }
              </div>

              <div class="description-section">
                <h3 class="section-title">–û–ø–∏—Å–∞–Ω–∏–µ</h3>
                <div class="description-text">
                  <p>{{ advertisement.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç' }}</p>

                  @if (advertisement.email) {
                    <div>
                      <p><strong>Email:</strong> {{ advertisement.email }}</p>
                    </div>
                  }

                  <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ advertisement.isActive ? '–ê–∫—Ç–∏–≤–Ω–æ' : '–ù–µ –∞–∫—Ç–∏–≤–Ω–æ' }}</p>

                  @if (advertisement.category) {
                    <div>
                      <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ advertisement.category.name }}</p>
                    </div>
                  }

                  <p><strong>–°–æ–∑–¥–∞–Ω–æ:</strong> {{ advertisement.createdAt | date:'dd.MM.yyyy HH:mm' }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="comments-section-wrapper">
          <app-comments [adId]="advertisement.id"></app-comments>
        </div>
      </div>
    }
  }
</div>
