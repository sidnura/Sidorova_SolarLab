<div class="add-advertisement-container">
  <div class="form-header">
    <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h2>
    <a routerLink="/ads" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º</a>
  </div>

  <div class="form-card">
    <form [formGroup]="adForm" (ngSubmit)="onSubmit()" class="ad-form">

      <div class="form-group">
        <label for="name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
        <input
          id="name"
          type="text"
          formControlName="name"
          placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è"
          class="form-control"
          [class.invalid]="name?.invalid && name?.touched">

        <div class="validation-errors" *ngIf="name?.invalid && name?.touched">
          <small *ngIf="name?.errors?.['required']">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</small>
          <small *ngIf="name?.errors?.['minlength']">
            –ú–∏–Ω–∏–º—É–º {{name?.errors?.['minlength']?.requiredLength}} —Å–∏–º–≤–æ–ª–æ–≤
          </small>
          <small *ngIf="name?.errors?.['maxlength']">
            –ú–∞–∫—Å–∏–º—É–º {{name?.errors?.['maxlength']?.requiredLength}} —Å–∏–º–≤–æ–ª–æ–≤
          </small>
        </div>
      </div>

      <div class="form-group">
        <label for="description" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <textarea
          id="description"
          formControlName="description"
          placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏–ª–∏ —É—Å–ª—É–≥—É..."
          rows="4"
          class="form-control"
          [class.invalid]="description?.invalid && description?.touched">
        </textarea>

        <div class="validation-errors" *ngIf="description?.invalid && description?.touched">
          <small *ngIf="description?.errors?.['maxlength']">
            –ú–∞–∫—Å–∏–º—É–º {{description?.errors?.['maxlength']?.requiredLength}} —Å–∏–º–≤–æ–ª–æ–≤
          </small>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
        <div class="file-upload-container">
          <input
            type="file"
            id="images"
            (change)="onFileSelected($event)"
            multiple
            accept="image/*"
            class="file-input">
          <label for="images" class="file-upload-label">
            <span class="upload-icon">üì∑</span>
            <span>–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
          </label>
        </div>

        <div class="image-previews" *ngIf="selectedFiles.length > 0">
          <div class="image-preview" *ngFor="let file of selectedFiles; let i = index">
            <img
              [src]="imageUrls[i]"
              [alt]="file.name"
              class="preview-img"
              (error)="onImageError($event, i)">
            <button type="button" class="remove-image-btn" (click)="removeImage(i)">√ó</button>
            <span class="image-name">{{ file.name }}</span>
          </div>
        </div>

        <small class="form-text">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</small>
      </div>

      <div class="form-group">
        <label for="cost" class="form-label">–¶–µ–Ω–∞ (‚ÇΩ) *</label>
        <input
          id="cost"
          type="number"
          formControlName="cost"
          placeholder="0"
          min="0"
          step="500"
          class="form-control"
          [class.invalid]="cost?.invalid && cost?.touched">

        <div class="validation-errors" *ngIf="cost?.invalid && cost?.touched">
          <small *ngIf="cost?.errors?.['required']">–£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É</small>
          <small *ngIf="cost?.errors?.['min']">–¶–µ–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π</small>
          <small *ngIf="cost?.errors?.['max']">–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è —Ü–µ–Ω–∞</small>
        </div>
      </div>

      <div class="form-group">
        <label for="email" class="form-label">Email</label>
        <input
          id="email"
          type="email"
          formControlName="email"
          placeholder="example@mail.com"
          class="form-control"
          [class.invalid]="email?.invalid && email?.touched">

        <div class="validation-errors" *ngIf="email?.invalid && email?.touched">
          <small *ngIf="email?.errors?.['email']">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email</small>
        </div>
      </div>

      <div class="form-group">
        <label for="phone" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
        <div class="phone-input-container">
          <span class="phone-prefix">+7</span>
          <input
            id="phone"
            type="tel"
            formControlName="phone"
            placeholder="(999) 123-45-67"
            class="form-control phone-input"
            [class.invalid]="phone?.invalid && phone?.touched"
            (input)="onPhoneInput($event)"
            (keydown)="onPhoneKeydown($event)"
            maxlength="18">
        </div>

        <div class="validation-errors" *ngIf="phone?.invalid && phone?.touched">
          <small *ngIf="phone?.errors?.['required']">–¢–µ–ª–µ—Ñ–æ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω</small>
          <small *ngIf="phone?.errors?.['pattern']">–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</small>
          <small *ngIf="phone?.errors?.['minlength']">–ù–æ–º–µ—Ä —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π</small>
        </div>
      </div>

      <div class="form-group">
        <label for="location" class="form-label">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ *</label>
        <input
          id="location"
          type="text"
          formControlName="location"
          placeholder="–ì–æ—Ä–æ–¥, –∞–¥—Ä–µ—Å –∏–ª–∏ —Ä–∞–π–æ–Ω"
          class="form-control"
          [class.invalid]="location?.invalid && location?.touched">

        <div class="validation-errors" *ngIf="location?.invalid && location?.touched">
          <small *ngIf="location?.errors?.['required']">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</small>
          <small *ngIf="location?.errors?.['minlength']">
            –ú–∏–Ω–∏–º—É–º {{location?.errors?.['minlength']?.requiredLength}} —Å–∏–º–≤–æ–ª–æ–≤
          </small>
          <small *ngIf="location?.errors?.['maxlength']">
            –ú–∞–∫—Å–∏–º—É–º {{location?.errors?.['maxlength']?.requiredLength}} —Å–∏–º–≤–æ–ª–æ–≤
          </small>
        </div>
      </div>

      <div class="form-group">
        <label for="parentCategoryId" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
        <select
          id="parentCategoryId"
          formControlName="parentCategoryId"
          class="form-control"
          [class.invalid]="parentCategoryId?.invalid && parentCategoryId?.touched">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
          <option *ngFor="let category of parentCategories" [value]="category.id">
            {{ category.name }}
          </option>
        </select>

        <div class="validation-errors" *ngIf="parentCategoryId?.invalid && parentCategoryId?.touched">
          <small *ngIf="parentCategoryId?.errors?.['required']">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</small>
        </div>
      </div>

      <div class="form-group" *ngIf="childCategories.length > 0">
        <label for="categoryId" class="form-label">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select
          id="categoryId"
          formControlName="categoryId"
          class="form-control"
          [class.invalid]="categoryId?.invalid && categoryId?.touched">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</option>
          <option *ngFor="let category of childCategories" [value]="category.id">
            {{ category.name }}
          </option>
        </select>
      </div>

      <div class="category-info" *ngIf="selectedParentCategory && childCategories.length === 0">
        <small>‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –≤—ã–±—Ä–∞–Ω–∞. –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã.</small>
      </div>

      <div *ngIf="errorMessage" class="alert alert-error">
        {{ errorMessage }}
      </div>

      <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
      </div>

      <!-- –ö–Ω–æ–ø–∫–∏ -->
      <div class="form-actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="onCancel()">
          –û—Ç–º–µ–Ω–∞
        </button>
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="adForm.invalid || isLoading">
          <span *ngIf="isLoading">–°–æ–∑–¥–∞–Ω–∏–µ...</span>
          <span *ngIf="!isLoading">–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</span>
        </button>
      </div>

    </form>
  </div>
</div>
