<div class="category-selector">
  <button
    class="category-selector-btn"
    (click)="toggleDropdown()"
    (mouseenter)="onButtonMouseEnter()"
    (mouseleave)="onButtonMouseLeave()">
    Все категории ▼
  </button>

  @if (isOpen) {
    <div
      class="category-dropdown"
      (mouseenter)="onDropdownMouseEnter()"
      (mouseleave)="onDropdownMouseLeave()">

      @if (isLoading) {
        <div class="loading-indicator">
          Загрузка категорий...
        </div>
      }

      @if (errorMessage && !isLoading) {
        <div class="error-message">
          {{ errorMessage }}
        </div>
      }

      @if (!isLoading && !errorMessage) {
        <div class="category-level">
          @for (category of parentCategories; track category.id) {
            <div
              class="category-item"
              (mouseenter)="onParentCategoryHover(category.id)"
              [class.active]="selectedParentCategory === category.id">
              {{ category.name }}
              @if (selectedParentCategory === category.id) {
                <span class="arrow">▶</span>
              }
            </div>
          }

          @if (parentCategories.length === 0) {
            <div class="no-categories">
              Категории не найдены
            </div>
          }
        </div>
      }

      @if (selectedParentCategory && childCategories.length > 0) {
        <div class="category-level child-level">
          @for (category of childCategories; track category.id) {
            <div
              class="category-item child"
              (click)="onCategorySelect(category.id)">
              {{ category.name }}
            </div>
          }

          <div
            class="category-item child all-category"
            (click)="onCategorySelect(selectedParentCategory)">
            Все в этой категории
          </div>
        </div>
      }

      @if (selectedParentCategory && childCategories.length === 0) {
        <div class="category-level child-level">
          <div
            class="category-item child all-category"
            (click)="onCategorySelect(selectedParentCategory)">
            Все в этой категории
          </div>
        </div>
      }
    </div>
  }
</div>
